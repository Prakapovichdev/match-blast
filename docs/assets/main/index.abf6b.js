window.__require=function e(t,o,i){function r(s,l){if(!o[s]){if(!t[s]){var a=s.split("/");if(a=a[a.length-1],!t[a]){var c="function"==typeof __require&&__require;if(!l&&c)return c(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var p=o[s]={exports:{}};t[s][0].call(p.exports,function(e){return r(t[s][1][e]||e)},p,p.exports,e,t,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({AppConfig:[function(e,t,o){"use strict";cc._RF.push(t,"91a480owvNEf5QiMUUDeB8O","AppConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfig=o.BoardConfig=void 0,o.BoardConfig={rows:9,cols:9},o.GameConfig={minGroupSize:2,baseScorePerTile:10,startMoves:20,targetScore:500,reshuffleLimit:3,startTeleports:5,bombRadius:1,startBombs:3,megaBombMinGroupSize:5,megaBombScoreMultiplier:2},cc._RF.pop()},{}],AppSignals:[function(e,t,o){"use strict";cc._RF.push(t,"17a909Sf9tDrJmj3d+jixHP","AppSignals"),Object.defineProperty(o,"__esModule",{value:!0}),o.AppSignal=void 0,function(e){e.SHOW_POPUP_WIN="SHOW_POPUP_WIN",e.SHOW_POPUP_LOSE="SHOW_POPUP_LOSE",e.HIDE_POPUPS="HIDE_POPUPS",e.TILE_CLICKED="TILE_CLICKED",e.BOOSTER_TELEPORT_CLICKED="BOOSTER_TELEPORT_CLICKED",e.BOOSTER_BOMB_CLICKED="BOOSTER_BOMB_CLICKED",e.NO_MOVES_OK_CLICKED="NO_MOVES_OK_CLICKED",e.MEGA_BOMB_EXPLODED="MEGA_BOMB_EXPLODED"}(o.AppSignal||(o.AppSignal={})),cc._RF.pop()},{}],BackgroundFloat:[function(e,t,o){"use strict";cc._RF.push(t,"2ddddToMmpKx5VElsSgIeAa","BackgroundFloat");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minOpacity=140,t.duration=3,t}return r(t,e),t.prototype.onLoad=function(){var e=this.node.opacity,t=cc.misc.clampf(this.minOpacity,0,255),o=this.duration/2;cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).repeatForever(cc.tween().to(o,{opacity:t}).to(o,{opacity:e})).start()},n([a({tooltip:"Minimum opacity during blink (0\u2013255)"})],t.prototype,"minOpacity",void 0),n([a({tooltip:"Total blink duration in seconds (fade out + fade in)"})],t.prototype,"duration",void 0),n([l],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],BoardFiller:[function(e,t,o){"use strict";cc._RF.push(t,"3f680VUJ2dMorancADyRZZW","BoardFiller");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../debug/Debug"),l=e("../shared/types"),a=e("./TileView"),c=cc._decorator,p=c.ccclass,u=c.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilePrefab=null,t.rows=9,t.cols=9,t.paddingX=4,t.paddingY=4,t.gapX=6,t.gapY=5,t.offsetY=0,t.tileSprites=[],t.bombFlashSprite=null,t.megaBombSprite=null,t.grid=[],t.viewGrid=[],t.tileWidth=0,t.tileHeight=0,t.startX=0,t.startY=0,t}return r(t,e),t.prototype.onLoad=function(){},t.prototype.renderFromGrid=function(e){if(e&&0!==e.length){this.grid=e;var t=e.length,o=e[0].length;this.rows=t,this.cols=o,this.recalculateLayout(t,o),this.node.removeAllChildren(),this.viewGrid=[];for(var i=0;i<t;i++){for(var r=e[i],n=[],l=0;l<o;l++){var a=r[l];if(a){var c=this.createTileView(i,l,a);n.push(c)}else n.push(null)}this.viewGrid.push(n)}}else s.debugLog("BoardFiller","renderFromGrid: empty grid")},t.prototype.applyGravityAndRefillAnimations=function(e,t,o,i){this.grid=e,this.tileWidth&&this.tileHeight||this.recalculateLayout(this.rows,this.cols);for(var r=0,n=function(){0===r&&i&&i()},s=0,l=t;s<l.length;s++){var a=l[s],c=a.from,p=a.to;if(f=this.getTileView(c.row,c.col)){this.viewGrid[p.row]||(this.viewGrid[p.row]=[]),this.viewGrid[p.row][p.col]=f,this.viewGrid[c.row][c.col]=null,f.row=p.row,f.col=p.col;var u=this.getTilePosition(p.row,p.col);r++,cc.Tween.stopAllByTarget(f.node),cc.tween(f.node).to(.15,{y:u.y}).call(function(){r--,n()}).start()}}for(var h=0,d=o;h<d.length;h++){var f,b=d[h],g=b.pos,v=b.color;(f=this.createTileView(g.row,g.col,v))&&(this.viewGrid[g.row]||(this.viewGrid[g.row]=[]),this.viewGrid[g.row][g.col]=f,r++,f.playSpawn(function(){r--,n()}))}0===r&&n()},t.prototype.getTileView=function(e,t){var o=this.viewGrid[e];return o&&o[t]||null},t.prototype.recalculateLayout=function(e,t){var o=this.node.getContentSize(),i=o.width,r=o.height,n=i-2*this.paddingX,l=r-2*this.paddingY,a=(n-(t-1)*this.gapX)/t,c=(l-(e-1)*this.gapY)/e,p=a,u=1.12*p;u>c&&(p=(u=c)/1.12);var h=t*p+(t-1)*this.gapX,d=e*u+(e-1)*this.gapY,f=n-h,b=l-d;this.tileWidth=p,this.tileHeight=u,this.startX=-n/2+f/2+p/2,this.startY=l/2-b/2-u/2+this.offsetY,s.debugLog("BoardFiller","recalculateLayout rows="+e+", cols="+t+", board="+i+"x"+r),s.debugLog("BoardFiller","cellW="+a.toFixed(1)+", cellH="+c.toFixed(1)+", tileW="+p.toFixed(1)+", tileH="+u.toFixed(1)),s.debugLog("BoardFiller","tilesTotalW="+h.toFixed(1)+", tilesTotalH="+d.toFixed(1)+", freeW="+f.toFixed(1)+", freeH="+b.toFixed(1))},t.prototype.getTilePosition=function(e,t){var o=this.startX+t*(this.tileWidth+this.gapX),i=this.startY-e*(this.tileHeight+this.gapY);return cc.v2(o,i)},t.prototype.createTileView=function(e,t,o){if(!this.tilePrefab)return s.debugLog("BoardFiller","WARNING: tilePrefab is not set"),null;var i=cc.instantiate(this.tilePrefab);i.parent=this.node,i.width=this.tileWidth,i.height=this.tileHeight;var r=i.getComponent(cc.Sprite)||i.getComponentInChildren(cc.Sprite);if(r)if(o===l.TileColor.MegaBomb)this.megaBombSprite?r.spriteFrame=this.megaBombSprite:s.debugLog("BoardFiller","WARNING: megaBombSprite is not assigned in inspector");else{var n=l.TILE_COLORS.indexOf(o);n>=0&&n<this.tileSprites.length?r.spriteFrame=this.tileSprites[n]:s.debugLog("BoardFiller","WARNING: no sprite for color="+o)}var c=this.getTilePosition(e,t);i.setPosition(c);var p=i.getComponent(a.default);return p?(p.setup(e,t,o),p):(s.debugLog("BoardFiller","WARNING: TileView component not found on prefab"),null)},t.prototype.removeTileViews=function(e,t){if(e&&0!==e.length){for(var o=[],i=new Set,r=0,n=e;r<n.length;r++){var s=n[r],l=s.row,a=s.col;(d=this.getTileView(l,a))&&(i.has(d)||(i.add(d),o.push(d),this.viewGrid[l]&&(this.viewGrid[l][a]=null)))}if(0!==o.length)for(var c=o.length,p=function(e){e.button&&(e.button.interactable=!1),cc.Tween.stopAllByTarget(e.node),e.playBurn(function(){e.node.destroy(),0==--c&&t&&t()})},u=0,h=o;u<h.length;u++){var d;p(d=h[u])}else t&&t()}else t&&t()},t.prototype.setMegaBombVisual=function(e,t){var o=this.getTileView(e,t);if(o){var i=o.node.getComponent(cc.Sprite)||o.node.getComponentInChildren(cc.Sprite);i?this.megaBombSprite?(s.debugLog("BoardFiller","setMegaBombVisual: row="+e+", col="+t+", apply megaBombSprite"),i.spriteFrame=this.megaBombSprite):s.debugLog("BoardFiller","setMegaBombVisual: megaBombSprite not assigned"):s.debugLog("BoardFiller","setMegaBombVisual: no Sprite on tile at "+e+","+t)}else s.debugLog("BoardFiller","setMegaBombVisual: no view at "+e+","+t)},t.prototype.playBombShake=function(e,t,o){void 0===e&&(e=.18),void 0===t&&(t=14);var i=this.node;cc.Tween.stopAllByTarget(i);var r=i.position.clone(),n=[cc.v2(-t,0),cc.v2(t,0),cc.v2(0,t),cc.v2(0,-t),cc.v2(0,0)],s=e/n.length,l=cc.tween(i);n.forEach(function(e){var t=cc.v2(r.x+e.x,r.y+e.y);l=l.to(s,{position:t})}),l.call(function(){i.setPosition(r),o&&o()}).start()},t.prototype.playBombFlash=function(e,t,o,i){if(void 0===o&&(o=1),void 0===i&&(i=.25),this.bombFlashSprite){var r=this.getTileView(e,t);if(r){var n=new cc.Node("BombFlash");n.addComponent(cc.Sprite).spriteFrame=this.bombFlashSprite,n.parent=this.node,n.setPosition(r.node.position);var s=r.node.width,l=r.node.height,a=1+.8*o;n.width=s*a*2,n.height=l*a*2,n.opacity=0,n.scale=.7,cc.tween(n).to(.4*i,{opacity:220,scale:1.05}).to(.6*i,{opacity:0,scale:1.4}).call(function(){n.destroy()}).start()}}},n([u(cc.Prefab)],t.prototype,"tilePrefab",void 0),n([u],t.prototype,"rows",void 0),n([u],t.prototype,"cols",void 0),n([u],t.prototype,"paddingX",void 0),n([u],t.prototype,"paddingY",void 0),n([u],t.prototype,"gapX",void 0),n([u],t.prototype,"gapY",void 0),n([u],t.prototype,"offsetY",void 0),n([u([cc.SpriteFrame])],t.prototype,"tileSprites",void 0),n([u(cc.SpriteFrame)],t.prototype,"bombFlashSprite",void 0),n([u(cc.SpriteFrame)],t.prototype,"megaBombSprite",void 0),n([p],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../debug/Debug":"Debug","../shared/types":"types","./TileView":"TileView"}],BoardModel:[function(e,t,o){"use strict";cc._RF.push(t,"7b2c0HsKB5GIIRRQtbHcnLh","BoardModel"),Object.defineProperty(o,"__esModule",{value:!0});var i=e("../debug/Debug"),r=e("../shared/types"),n=function(){function e(e,t,o){this.grid=[],this.specialGrid=[],this.rows=e,this.cols=t,this.availableColors=o&&o.length?o.slice():r.TILE_COLORS.slice(),i.debugLog("BoardModel","ctor rows="+e+", cols="+t+", colors="+this.availableColors.length)}return e.prototype.randomFill=function(){this.grid=[],this.specialGrid=[];for(var e=0;e<this.rows;e++){for(var t=[],o=[],i=0;i<this.cols;i++){var n=Math.floor(Math.random()*this.availableColors.length);t.push(this.availableColors[n]),o.push(r.TileSpecial.None)}this.grid.push(t),this.specialGrid.push(o)}},e.prototype.inBounds=function(e,t){return e>=0&&e<this.rows&&t>=0&&t<this.cols},e.prototype.getSpecial=function(e,t){return this.inBounds(e,t)?this.specialGrid[e][t]:r.TileSpecial.None},e.prototype.setSpecial=function(e,t,o){this.inBounds(e,t)&&(this.specialGrid[e][t]=o)},e.prototype.isMegaBomb=function(e,t){return this.getSpecial(e,t)===r.TileSpecial.MegaBomb},e.prototype.findGroup=function(e,t){if(!this.inBounds(e,t))return[];var o=this.grid[e][t];if(!o)return i.debugLog("BoardModel","findGroup from ("+e+","+t+") -> empty cell"),[];for(var r=[],n=0;n<this.rows;n++){r[n]=[];for(var s=0;s<this.cols;s++)r[n][s]=!1}for(var l=[{row:e,col:t}],a=[];l.length>0;){var c=l.pop(),p=c.row,u=c.col;this.inBounds(p,u)&&(r[p][u]||(r[p][u]=!0,this.grid[p][u]===o&&(a.push({row:p,col:u}),l.push({row:p-1,col:u}),l.push({row:p+1,col:u}),l.push({row:p,col:u-1}),l.push({row:p,col:u+1}))))}return i.debugLog("BoardModel","findGroup from ("+e+","+t+") color="+o+" size="+a.length),a},e.prototype.removeGroup=function(e){if(e&&0!==e.length){i.debugLog("BoardModel","removeGroup size="+e.length);for(var t=this.grid,o=this.specialGrid,n=0,s=e;n<s.length;n++){var l=s[n],a=l.row,c=l.col;this.inBounds(a,c)&&(t[a][c]=null,o[a][c]=r.TileSpecial.None)}}},e.prototype.applyGravity=function(){i.debugLog("BoardModel","applyGravity");for(var e=this.grid,t=this.specialGrid,o=[],n=0;n<this.cols;n++){for(var s=this.rows-1,l=this.rows-1;l>=0;l--){var a=e[l][n];if(null!==a){if(s!==l){var c=t[l][n];e[s][n]=a,e[l][n]=null,t[s][n]=c,t[l][n]=r.TileSpecial.None,o.push({from:{row:l,col:n},to:{row:s,col:n},color:a})}s--}}for(l=s;l>=0;l--)e[l][n]=null,t[l][n]=r.TileSpecial.None}return o},e.prototype.refillEmptyCells=function(){i.debugLog("BoardModel","refillEmptyCells");for(var e=this.grid,t=this.specialGrid,o=[],n=0;n<this.rows;n++)for(var s=0;s<this.cols;s++)if(null===e[n][s]){var l=Math.floor(Math.random()*this.availableColors.length),a=this.availableColors[l];e[n][s]=a,t[n][s]=r.TileSpecial.None,o.push({pos:{row:n,col:s},color:a})}return o},e.prototype.hasAnyMoves=function(e){if(e<=1)return!0;for(var t=0;t<this.rows;t++)for(var o=0;o<this.cols;o++){var i=this.grid[t][o];if(i){if(this.inBounds(t+1,o)&&this.grid[t+1][o]===i)return!0;if(this.inBounds(t,o+1)&&this.grid[t][o+1]===i)return!0}}return!1},e.prototype.swapTiles=function(e,t){if(this.inBounds(e.row,e.col)&&this.inBounds(t.row,t.col)){var o=this.grid,i=this.specialGrid,r=o[e.row][e.col];o[e.row][e.col]=o[t.row][t.col],o[t.row][t.col]=r;var n=i[e.row][e.col];i[e.row][e.col]=i[t.row][t.col],i[t.row][t.col]=n}},e.prototype.clearAllTiles=function(){for(var e=this.grid,t=this.specialGrid,o=[],i=0;i<this.rows;i++)for(var n=0;n<this.cols;n++)null!==e[i][n]&&(o.push({row:i,col:n}),e[i][n]=null,t[i][n]=r.TileSpecial.None);return o},e.prototype.countNonEmptyTiles=function(){for(var e=0,t=this.grid,o=0;o<this.rows;o++)for(var i=0;i<this.cols;i++)null!==t[o][i]&&e++;return e},e}();o.default=n,cc._RF.pop()},{"../debug/Debug":"Debug","../shared/types":"types"}],BombController:[function(e,t,o){"use strict";cc._RF.push(t,"3ece1qwHW9HLZ+cc6zgjlk1","BombController"),Object.defineProperty(o,"__esModule",{value:!0});var i=e("../AppConfig"),r=function(){function e(e,t){void 0===t&&(t=i.GameConfig.bombRadius),this.active=!1,this.board=e,this.radius=t}return e.prototype.setBoard=function(e){this.board=e,this.active=!1},e.prototype.setRadius=function(e){this.radius=e},e.prototype.getRadius=function(){return this.radius},e.prototype.reset=function(){this.active=!1},e.prototype.toggle=function(){this.active=!this.active},e.prototype.isActive=function(){return this.active},e.prototype.handleClick=function(e,t){if(!this.active||!this.board)return[];this.active=!1;for(var o=[],i=this.board.rows,r=this.board.cols,n=e,s=t,l=this.radius,a=n-l;a<=n+l;a++)for(var c=s-l;c<=s+l;c++)a<0||a>=i||c<0||c>=r||null!==this.board.grid[a][c]&&o.push({row:a,col:c});return o},e}();o.default=r,cc._RF.pop()},{"../AppConfig":"AppConfig"}],BoosterBombButton:[function(e,t,o){"use strict";cc._RF.push(t,"7af97Rm0AhFBJryHut/KxOJ","BoosterBombButton");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../debug/Debug"),l=e("../app/EventBus"),a=e("../app/AppSignals"),c=cc._decorator,p=c.ccclass,u=c.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.countLabel=null,t.button=null,t.baseScale=1,t.isActive=!1,t}return r(t,e),t.prototype.onLoad=function(){this.button||(this.button=this.getComponent(cc.Button)),this.baseScale=this.node.scale,this.node.on(cc.Node.EventType.MOUSE_ENTER,this.onHoverEnter,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onHoverLeave,this)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.MOUSE_ENTER,this.onHoverEnter,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this.onHoverLeave,this)},t.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this.node),this.node.scale=this.baseScale},t.prototype.setCount=function(e){this.countLabel&&(this.countLabel.string=String(e));var t=e>0;this.button&&(this.button.interactable=t),t?this.node.opacity=255:(this.setActive(!1),this.node.opacity=160)},t.prototype.setActive=function(e){this.isActive!==e&&(this.isActive=e,cc.Tween.stopAllByTarget(this.node),e?(this.node.scale=1.08*this.baseScale,cc.tween(this.node).to(.2,{scale:1.12*this.baseScale}).to(.2,{scale:1.08*this.baseScale}).union().repeatForever().start()):cc.tween(this.node).to(.15,{scale:this.baseScale}).start())},t.prototype.onClick=function(){s.debugLog("BoosterBombButton","CLICK"),this.playClickPulse(),l.default.I.emit(a.AppSignal.BOOSTER_BOMB_CLICKED)},t.prototype.onHoverEnter=function(){this.button&&!this.button.interactable||this.isActive||(cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.08,{scale:1.06*this.baseScale}).start())},t.prototype.onHoverLeave=function(){this.button&&!this.button.interactable||this.isActive||(cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.1,{scale:this.baseScale}).start())},t.prototype.playClickPulse=function(){this.button&&!this.button.interactable||(cc.Tween.stopAllByTarget(this.node),this.isActive?cc.tween(this.node).to(.06,{scale:1.14*this.baseScale}).to(.1,{scale:1.08*this.baseScale}).start():cc.tween(this.node).to(.06,{scale:1.08*this.baseScale}).to(.1,{scale:this.baseScale}).start())},n([u({tooltip:"Label showing remaining bomb charges"})],t.prototype,"countLabel",void 0),n([u(cc.Button)],t.prototype,"button",void 0),n([p],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../app/AppSignals":"AppSignals","../app/EventBus":"EventBus","../debug/Debug":"Debug"}],BoosterTeleportButton:[function(e,t,o){"use strict";cc._RF.push(t,"a46f8oqv8lNG65R6fCBjmz1","BoosterTeleportButton");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=e("../app/EventBus"),p=e("../app/AppSignals"),u=e("../debug/Debug"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=null,t.countLabel=null,t.baseScale=1,t.isActive=!1,t}return r(t,e),t.prototype.onLoad=function(){this.button||(this.button=this.getComponent(cc.Button)),this.baseScale=this.node.scale,this.node.on(cc.Node.EventType.MOUSE_ENTER,this.onHoverEnter,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onHoverLeave,this)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.MOUSE_ENTER,this.onHoverEnter,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this.onHoverLeave,this)},t.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this.node),this.node.scale=this.baseScale},t.prototype.setCount=function(e){this.countLabel&&(this.countLabel.string=String(e));var t=e>0;this.button&&(this.button.interactable=t),t?this.node.opacity=255:(this.setActive(!1),this.node.opacity=160)},t.prototype.onClick=function(){u.debugLog("BoosterTeleportButton","CLICK"),this.playClickPulse(),c.default.I.emit(p.AppSignal.BOOSTER_TELEPORT_CLICKED)},t.prototype.setActive=function(e){this.isActive!==e&&(this.isActive=e,cc.Tween.stopAllByTarget(this.node),e?(this.node.scale=1.08*this.baseScale,cc.tween(this.node).to(.2,{scale:1.12*this.baseScale}).to(.2,{scale:1.08*this.baseScale}).union().repeatForever().start()):cc.tween(this.node).to(.15,{scale:this.baseScale}).start())},t.prototype.onHoverEnter=function(){this.button&&!this.button.interactable||this.isActive||(cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.08,{scale:1.06*this.baseScale}).start())},t.prototype.onHoverLeave=function(){this.button&&!this.button.interactable||this.isActive||(cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.1,{scale:this.baseScale}).start())},t.prototype.playClickPulse=function(){this.button&&!this.button.interactable||(cc.Tween.stopAllByTarget(this.node),this.isActive?cc.tween(this.node).to(.06,{scale:1.14*this.baseScale}).to(.1,{scale:1.08*this.baseScale}).start():cc.tween(this.node).to(.06,{scale:1.08*this.baseScale}).to(.1,{scale:this.baseScale}).start())},n([a(cc.Button)],t.prototype,"button",void 0),n([a({tooltip:"Label showing remaining teleport charges"})],t.prototype,"countLabel",void 0),n([l],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../app/AppSignals":"AppSignals","../app/EventBus":"EventBus","../debug/Debug":"Debug"}],Debug:[function(e,t,o){"use strict";cc._RF.push(t,"00ae37q6n1HP7UoNjFz2rbl","Debug");var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<o;t++)for(var n=arguments[t],s=0,l=n.length;s<l;s++,r++)i[r]=n[s];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.debugLog=o.setDebug=void 0;var r=!1;o.setDebug=function(e){r=e},o.debugLog=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];r&&cc.log.apply(cc,i(["["+e+"]"],t))},cc._RF.pop()},{}],EventBus:[function(e,t,o){"use strict";cc._RF.push(t,"f7e75oATdJG4JX9tTRxtX52","EventBus"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function e(){this.listeners=new Map}return Object.defineProperty(e,"I",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){var o=this.listeners.get(e)||[];-1===o.indexOf(t)&&(o.push(t),this.listeners.set(e,o))},e.prototype.off=function(e,t){var o=this.listeners.get(e);if(o){var i=o.indexOf(t);-1!==i&&o.splice(i,1),0===o.length&&this.listeners.delete(e)}},e.prototype.emit=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var i=this.listeners.get(e);if(i)for(var r=i.slice(),n=0,s=r;n<s.length;n++){var l=s[n];try{l.apply(void 0,t)}catch(a){console.error('[EventBus] error in handler for "'+e+'"',a)}}},e}();o.default=i,cc._RF.pop()},{}],GameController:[function(e,t,o){"use strict";cc._RF.push(t,"c53bdvo+KpGOaF0VWg5h7/M","GameController"),Object.defineProperty(o,"__esModule",{value:!0});var i=e("../debug/Debug"),r=e("../shared/types"),n=e("../domain/BoardModel"),s=e("./GameState"),l=e("./AppConfig"),a=e("./controllers/TeleportController"),c=e("./controllers/BombController"),p=e("./controllers/MegaBombController"),u=function(){function e(e,t){this.boardModel=null,this.hudScore=null,this.gameState=null,this.lastSelected=null,this.isAnimating=!1,this.onWin=null,this.onLose=null,this.onNoMoves=null,this.onBombsChanged=null,this.onTeleportsChanged=null,this.boardFiller=e,this.hudScore=t,this.teleportController=new a.default(null),this.bombController=new c.default(null),this.megaBombController=new p.default(null,l.GameConfig.megaBombMinGroupSize)}return e.prototype.initNewGame=function(){i.debugLog("GameController","initNewGame()"),this.isAnimating=!1,this.boardModel=new n.default(l.BoardConfig.rows,l.BoardConfig.cols,r.TILE_COLORS),this.boardModel.randomFill(),this.boardFiller.renderFromGrid(this.boardModel.grid),this.gameState=new s.default,this.lastSelected=null,this.teleportController.setBoard(this.boardModel),this.teleportController.reset(),this.bombController.setBoard(this.boardModel),this.bombController.reset(),this.megaBombController.setBoard(this.boardModel),i.debugLog("GameController","state: score="+this.gameState.data.score+", movesLeft="+this.gameState.data.movesLeft+", target="+this.gameState.data.targetScore+", reshufflesLeft="+this.gameState.data.reshufflesLeft+", bombsLeft="+this.gameState.data.bombsLeft+", teleportsLeft="+this.gameState.data.teleportsLeft),this.hudScore&&this.hudScore.applyGameState(this.gameState.data),this.onBombsChanged&&this.onBombsChanged(this.gameState.data.bombsLeft),this.onTeleportsChanged&&this.onTeleportsChanged(this.gameState.data.teleportsLeft),this.ensureHasMoves()},e.prototype.onTileClick=function(e){if(this.isGameInteractive()&&this.boardModel)if(this.teleportController.isActive()){var t=this.teleportController.handleClick(e);this.handleTeleportResult(t)}else this.bombController.isActive()?this.handleBombClick(e):this.megaBombController.isMegaBomb(e.row,e.col)?this.handleMegaBombClick(e.row,e.col):this.handleNormalTileClick(e)},e.prototype.onBoosterTeleportClick=function(){this.isGameInteractive()&&this.gameState&&(this.gameState.canUseTeleport()?(this.bombController.reset(),this.clearSelection(),this.teleportController.toggle()):i.debugLog("GameController","Booster TELEPORT clicked, but no teleports left"))},e.prototype.onBoosterBombClick=function(){this.isGameInteractive()&&this.gameState&&(this.gameState.canUseBomb()?(this.teleportController.reset(),this.bombController.toggle()):i.debugLog("GameController","Booster BOMB clicked, but no bombs left"))},e.prototype.onNoMovesPopupOk=function(){this.isGameInteractive()&&this.gameState&&(this.gameState.useReshuffle()?(this.reshuffleBoard(),this.ensureHasMoves(),this.checkGameOver()):this.forceLoseByNoMoves())},e.prototype.onRestartRequested=function(){this.initNewGame()},e.prototype.handleNormalTileClick=function(e){if(this.boardModel&&this.gameState){var t=this.boardModel.findGroup(e.row,e.col),o=t.length;if(this.gameState.canRemoveGroup(o)){this.clearSelection(),this.gameState.applyGroup(o);var i={row:e.row,col:e.col};if(this.megaBombController.canCreateFromSize(o)){var r=this.megaBombController.createFromGroup(t,i);if(r.created)return this.boardFiller.setMegaBombVisual(i.row,i.col),void this.applyBoardChangesAndEndTurn({removedCells:r.removedCells})}this.boardModel.removeGroup(t),this.applyBoardChangesAndEndTurn({removedCells:t})}}},e.prototype.handleBombClick=function(e){if(this.boardModel&&this.gameState){var t=this.bombController.handleClick(e.row,e.col),o=t.length;if(0!==o)if(this.gameState.useBomb()){var r=this.gameState.applyBomb(o);i.debugLog("GameController","BOMB remove size="+o+", gained="+r+", score="+this.gameState.data.score+", movesLeft="+this.gameState.data.movesLeft+", bombsLeft="+this.gameState.data.bombsLeft);var n=this.bombController.getRadius();this.boardFiller.playBombShake(),this.boardFiller.playBombFlash(e.row,e.col,n),this.boardModel.removeGroup(t),this.applyBoardChangesAndEndTurn({updateBombs:!0,removedCells:t})}else i.debugLog("GameController","Bomb click, but no bombs left in state");else i.debugLog("GameController","Bomb click: no cells to remove")}},e.prototype.handleMegaBombClick=function(e,t){if(this.boardModel&&this.gameState){var o=this.megaBombController.explode(e,t);if(o){var r=o.removedCells,n=o.totalTiles;this.clearSelection(),this.teleportController.reset(),this.bombController.reset();var s=this.gameState.applyBomb(n);i.debugLog("GameController","MEGA BOMB explode, tiles="+n+", gained="+s+", score="+this.gameState.data.score+", movesLeft="+this.gameState.data.movesLeft),this.boardFiller.playBombShake(),this.boardFiller.playBombFlash(e,t,Math.max(this.boardModel.rows,this.boardModel.cols)),this.applyBoardChangesAndEndTurn({removedCells:r})}}},e.prototype.handleTeleportResult=function(e){var t=this;if(e)switch(e.type){case"select":(o=this.boardFiller.getTileView(e.pos.row,e.pos.col))&&o.setSelected(!0);break;case"deselect":var o;(o=this.boardFiller.getTileView(e.pos.row,e.pos.col))&&o.setSelected(!1);break;case"reselect":var r=this.boardFiller.getTileView(e.from.row,e.from.col);r&&r.setSelected(!1);var n=this.boardFiller.getTileView(e.to.row,e.to.col);n&&n.setSelected(!0);break;case"swap":if(!this.boardModel||!this.gameState)return;this.gameState.useTeleport()?i.debugLog("GameController","Teleport used, teleportsLeft="+this.gameState.data.teleportsLeft):i.debugLog("GameController","Teleport swap performed, but no teleports left in state"),this.onTeleportsChanged&&this.onTeleportsChanged(this.gameState.data.teleportsLeft);var s=e.from,l=e.to,a=this.boardFiller.getTileView(s.row,s.col),c=this.boardFiller.getTileView(l.row,l.col);if(!a||!c)return this.boardFiller.renderFromGrid(this.boardModel.grid),this.ensureHasMoves(),void this.checkGameOver();var p=a.node.position.clone(),u=c.node.position.clone();a.button&&(a.button.interactable=!1),c.button&&(c.button.interactable=!1),this.isAnimating=!0;var h=0,d=function(){++h<2||(t.boardFiller.renderFromGrid(t.boardModel.grid),t.ensureHasMoves(),t.checkGameOver(),t.isAnimating=!1)};a.playTeleportSwap(u,d),c.playTeleportSwap(p,d)}},e.prototype.ensureHasMoves=function(){this.boardModel&&this.gameState&&(this.gameState.data.gameOver||this.boardModel.hasAnyMoves(l.GameConfig.minGroupSize)||(this.gameState.canUseReshuffle()?this.onNoMoves&&this.onNoMoves(this.gameState.data.reshufflesLeft):this.forceLoseByNoMoves()))},e.prototype.forceLoseByNoMoves=function(){this.gameState&&(this.gameState.data.gameOver||(this.gameState.data.gameOver=!0,this.gameState.data.gameOverReason="lose",this.checkGameOver()))},e.prototype.reshuffleBoard=function(){this.boardModel&&this.gameState&&(this.gameState.data.gameOver||(this.boardModel.randomFill(),this.boardFiller.renderFromGrid(this.boardModel.grid),this.lastSelected=null,this.teleportController.reset(),this.bombController.reset()))},e.prototype.checkGameOver=function(){this.gameState&&this.gameState.data.gameOver&&("win"===this.gameState.data.gameOverReason?(i.debugLog("GameController","GAME OVER: WIN"),this.onWin&&this.onWin()):"lose"===this.gameState.data.gameOverReason&&(i.debugLog("GameController","GAME OVER: LOSE"),this.onLose&&this.onLose()))},e.prototype.isGameInteractive=function(){return!(!this.boardModel||!this.gameState||this.gameState.data.gameOver||this.isAnimating)},e.prototype.clearSelection=function(){if(this.lastSelected){var e=this.boardFiller.getTileView(this.lastSelected.row,this.lastSelected.col);e&&e.setSelected(!1),this.lastSelected=null}},e.prototype.isTeleportActive=function(){return this.teleportController.isActive()},e.prototype.isBombActive=function(){return this.bombController.isActive()},e.prototype.applyBoardChangesAndEndTurn=function(e){var t=this;if(void 0===e&&(e={}),this.boardModel&&this.gameState){this.isAnimating=!0;var o=function(){var o=t.boardModel.applyGravity(),i=t.boardModel.refillEmptyCells();t.boardFiller.applyGravityAndRefillAnimations(t.boardModel.grid,o,i,function(){t.lastSelected=null,t.hudScore&&t.hudScore.applyGameState(t.gameState.data),e.updateBombs&&t.onBombsChanged&&t.onBombsChanged(t.gameState.data.bombsLeft),t.ensureHasMoves(),t.checkGameOver(),t.isAnimating=!1})},i=e.removedCells;i&&i.length>0?this.boardFiller.removeTileViews(i,o):o()}},e}();o.default=u,cc._RF.pop()},{"../debug/Debug":"Debug","../domain/BoardModel":"BoardModel","../shared/types":"types","./AppConfig":"AppConfig","./GameState":"GameState","./controllers/BombController":"BombController","./controllers/MegaBombController":"MegaBombController","./controllers/TeleportController":"TeleportController"}],GameEntry:[function(e,t,o){"use strict";cc._RF.push(t,"a7897Jb3mNHK5KP5L8gXfyo","GameEntry");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./EventBus"),l=e("./AppSignals"),a=e("../debug/Debug"),c=e("../board/BoardFiller"),p=e("../ui/HUDScore"),u=e("./GameController"),h=e("../ui/PopupNoMoves"),d=e("../ui/BoosterTeleportButton"),f=e("../ui/BoosterBombButton"),b=e("../ui/PopupSimple"),g=cc._decorator,v=g.ccclass,y=g.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.overlayRoot=null,t.popupWin=null,t.popupLose=null,t.popupNoMoves=null,t.boardFiller=null,t.hudScore=null,t.boosterTeleportButton=null,t.boosterBombButton=null,t.controller=null,t.onShowWinSignal=function(){return t.showWin()},t.onShowLoseSignal=function(){return t.showLose()},t.onHidePopupsSignal=function(){return t.hideAllPopups()},t.onTileClickedSignal=function(e){t.controller&&(t.controller.onTileClick(e),t.syncBoosterStates())},t.onBoosterTeleportSignal=function(){t.controller&&(t.controller.onBoosterTeleportClick(),t.syncBoosterStates())},t.onBoosterBombSignal=function(){t.controller&&(t.controller.onBoosterBombClick(),t.syncBoosterStates())},t.onNoMovesOkSignal=function(){t.controller&&(t.popupNoMoves&&t.popupNoMoves.hide(),t.overlayRoot&&(t.overlayRoot.active=!1),t.controller.onNoMovesPopupOk(),t.syncBoosterStates())},t}return r(t,e),t.prototype.onLoad=function(){var e=this;a.setDebug(!1),a.debugLog("GameEntry","onLoad"),this.hideAllPopups(),this.boardFiller?(this.controller=new u.default(this.boardFiller,this.hudScore),this.controller.onWin=function(){return e.showWin()},this.controller.onLose=function(){return e.showLose()},this.controller.onNoMoves=function(t){a.debugLog("GameEntry","NO MOVES, reshufflesLeft="+t),e.overlayRoot&&e.popupNoMoves&&(e.overlayRoot.active=!0,e.popupWin&&e.popupWin.hide(),e.popupLose&&e.popupLose.hide(),e.popupNoMoves.show(t))},this.controller.onBombsChanged=function(t){e.boosterBombButton&&e.boosterBombButton.setCount(t)},this.controller.onTeleportsChanged=function(t){e.boosterTeleportButton&&e.boosterTeleportButton.setCount(t)},s.default.I.on(l.AppSignal.SHOW_POPUP_WIN,this.onShowWinSignal),s.default.I.on(l.AppSignal.SHOW_POPUP_LOSE,this.onShowLoseSignal),s.default.I.on(l.AppSignal.HIDE_POPUPS,this.onHidePopupsSignal),s.default.I.on(l.AppSignal.TILE_CLICKED,this.onTileClickedSignal),s.default.I.on(l.AppSignal.BOOSTER_TELEPORT_CLICKED,this.onBoosterTeleportSignal),s.default.I.on(l.AppSignal.NO_MOVES_OK_CLICKED,this.onNoMovesOkSignal),s.default.I.on(l.AppSignal.BOOSTER_BOMB_CLICKED,this.onBoosterBombSignal),this.controller.initNewGame(),this.syncBoosterStates(),this.popupWin&&(this.popupWin.onOk=function(){return e.onPopupOkClicked()}),this.popupLose&&(this.popupLose.onOk=function(){return e.onPopupOkClicked()})):a.debugLog("GameEntry","ERROR: boardFiller is not assigned")},t.prototype.onDestroy=function(){s.default.I.off(l.AppSignal.SHOW_POPUP_WIN,this.onShowWinSignal),s.default.I.off(l.AppSignal.SHOW_POPUP_LOSE,this.onShowLoseSignal),s.default.I.off(l.AppSignal.HIDE_POPUPS,this.onHidePopupsSignal),s.default.I.off(l.AppSignal.TILE_CLICKED,this.onTileClickedSignal),s.default.I.off(l.AppSignal.BOOSTER_TELEPORT_CLICKED,this.onBoosterTeleportSignal),s.default.I.off(l.AppSignal.NO_MOVES_OK_CLICKED,this.onNoMovesOkSignal),s.default.I.off(l.AppSignal.BOOSTER_BOMB_CLICKED,this.onBoosterBombSignal)},t.prototype.showWin=function(){a.debugLog("GameEntry","showWin()"),this.overlayRoot&&this.popupWin&&(this.overlayRoot.active=!0,this.popupLose&&this.popupLose.hide(),this.popupNoMoves&&(this.popupNoMoves.node.active=!1),this.popupWin.show("\u041f\u041e\u0411\u0415\u0414\u0410!"))},t.prototype.showLose=function(){a.debugLog("GameEntry","showLose()"),this.overlayRoot&&this.popupLose&&(this.overlayRoot.active=!0,this.popupWin&&this.popupWin.hide(),this.popupNoMoves&&(this.popupNoMoves.node.active=!1),this.popupLose.show("\u041f\u0420\u041e\u0418\u0413\u0420\u042b\u0428"))},t.prototype.hideAllPopups=function(){this.overlayRoot&&(this.overlayRoot.active=!1),this.popupWin&&(this.popupWin.node.active=!1),this.popupLose&&(this.popupLose.node.active=!1),this.popupNoMoves&&(this.popupNoMoves.node.active=!1)},t.prototype.onPopupOkClicked=function(){this.hideAllPopups(),this.controller&&(this.controller.onRestartRequested(),this.syncBoosterStates())},t.prototype.syncBoosterStates=function(){this.controller&&(this.boosterTeleportButton&&this.boosterTeleportButton.setActive(this.controller.isTeleportActive()),this.boosterBombButton&&this.boosterBombButton.setActive(this.controller.isBombActive()))},n([y(cc.Node)],t.prototype,"overlayRoot",void 0),n([y(b.default)],t.prototype,"popupWin",void 0),n([y(b.default)],t.prototype,"popupLose",void 0),n([y(h.default)],t.prototype,"popupNoMoves",void 0),n([y(c.default)],t.prototype,"boardFiller",void 0),n([y(p.default)],t.prototype,"hudScore",void 0),n([y(d.default)],t.prototype,"boosterTeleportButton",void 0),n([y(f.default)],t.prototype,"boosterBombButton",void 0),n([v],t)}(cc.Component);o.default=m,cc._RF.pop()},{"../board/BoardFiller":"BoardFiller","../debug/Debug":"Debug","../ui/BoosterBombButton":"BoosterBombButton","../ui/BoosterTeleportButton":"BoosterTeleportButton","../ui/HUDScore":"HUDScore","../ui/PopupNoMoves":"PopupNoMoves","../ui/PopupSimple":"PopupSimple","./AppSignals":"AppSignals","./EventBus":"EventBus","./GameController":"GameController"}],GameState:[function(e,t,o){"use strict";cc._RF.push(t,"b5834GTQ8dA+qjwriiaEISv","GameState"),Object.defineProperty(o,"__esModule",{value:!0});var i=e("./AppConfig"),r=function(){function e(){this.data={score:0,movesLeft:i.GameConfig.startMoves,targetScore:i.GameConfig.targetScore,gameOver:!1,gameOverReason:null,reshufflesLeft:i.GameConfig.reshuffleLimit,bombsLeft:i.GameConfig.startBombs,teleportsLeft:i.GameConfig.startTeleports}}return e.prototype.canRemoveGroup=function(e){return!this.data.gameOver&&e>=i.GameConfig.minGroupSize},e.prototype.applyGroup=function(e){if(!this.canRemoveGroup(e))return 0;var t=e*i.GameConfig.baseScorePerTile;return this.data.score+=t,this.data.movesLeft-=1,this.updateGameOver(),t},e.prototype.updateGameOver=function(){if(!this.data.gameOver)return this.data.score>=this.data.targetScore?(this.data.gameOver=!0,void(this.data.gameOverReason="win")):this.data.movesLeft<=0?(this.data.gameOver=!0,void(this.data.gameOverReason="lose")):void 0},e.prototype.canUseReshuffle=function(){return!this.data.gameOver&&this.data.reshufflesLeft>0},e.prototype.useReshuffle=function(){return!!this.canUseReshuffle()&&(this.data.reshufflesLeft-=1,!0)},e.prototype.canUseBomb=function(){return!this.data.gameOver&&this.data.bombsLeft>0},e.prototype.useBomb=function(){return!!this.canUseBomb()&&(this.data.bombsLeft-=1,!0)},e.prototype.applyBomb=function(e){if(this.data.gameOver||e<=0)return 0;var t=e*i.GameConfig.baseScorePerTile;return this.data.score+=t,this.updateGameOver(),t},e.prototype.canUseTeleport=function(){return!this.data.gameOver&&this.data.teleportsLeft>0},e.prototype.useTeleport=function(){return!!this.canUseTeleport()&&(this.data.teleportsLeft-=1,!0)},e}();o.default=r,cc._RF.pop()},{"./AppConfig":"AppConfig"}],HUDScore:[function(e,t,o){"use strict";cc._RF.push(t,"0126aJyVkFNrbNWhTmqDgJ5","HUDScore");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.titleLabel=null,t.valueLabel=null,t.movesLabel=null,t.titleText="SCORE:",t.current=0,t.target=500,t.moves=0,t}return r(t,e),t.prototype.onLoad=function(){this.refreshLabels()},t.prototype.applyGameState=function(e){e&&(this.current=e.score,this.target=e.targetScore,this.moves=e.movesLeft,this.refreshLabels())},t.prototype.setScore=function(e,t){this.current=e,"number"==typeof t&&(this.target=t),this.refreshLabels()},t.prototype.setMoves=function(e){this.moves=e,this.refreshLabels()},t.prototype.refreshLabels=function(){this.titleLabel&&(this.titleLabel.string=this.titleText),this.valueLabel&&(this.valueLabel.string=this.current+"/"+this.target),this.movesLabel&&(this.movesLabel.string=""+this.moves)},n([a(cc.Label)],t.prototype,"titleLabel",void 0),n([a(cc.Label)],t.prototype,"valueLabel",void 0),n([a(cc.Label)],t.prototype,"movesLabel",void 0),n([a],t.prototype,"titleText",void 0),n([a],t.prototype,"current",void 0),n([a],t.prototype,"target",void 0),n([a],t.prototype,"moves",void 0),n([l],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],MegaBombController:[function(e,t,o){"use strict";cc._RF.push(t,"e48461hy2RFt6DDfap5W0HA","MegaBombController"),Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../shared/types"),r=e("../../debug/Debug"),n=function(){function e(e,t){this.board=null,this.board=e,this.minGroupSize=t}return e.prototype.setBoard=function(e){this.board=e},e.prototype.canCreateFromSize=function(e){return e>=this.minGroupSize},e.prototype.isMegaBomb=function(e,t){return!!this.board&&this.board.grid[e][t]===i.TileColor.MegaBomb},e.prototype.createFromGroup=function(e,t){if(!this.board)return{created:!1,removedCells:[]};var o=e.length;if(o<this.minGroupSize)return{created:!1,removedCells:[]};var n=e.filter(function(e){return!(e.row===t.row&&e.col===t.col)});return this.board.removeGroup(n),this.board.grid[t.row][t.col]=i.TileColor.MegaBomb,r.debugLog("MegaBombController","Create MegaBomb at ("+t.row+","+t.col+"), groupSize="+o),{created:!0,center:t,removedCells:n}},e.prototype.explode=function(e,t){if(!this.board)return null;if(this.board.grid[e][t]!==i.TileColor.MegaBomb)return r.debugLog("MegaBombController","explode: cell ("+e+","+t+") is not MegaBomb"),null;for(var o=[],n=0;n<this.board.rows;n++)for(var s=0;s<this.board.cols;s++)null!=this.board.grid[n][s]&&o.push({row:n,col:s});var l=o.length;return 0===l?(r.debugLog("MegaBombController","explode: board already empty"),null):(this.board.removeGroup(o),r.debugLog("MegaBombController","explode: tiles="+l+" (MegaBomb at "+e+","+t+")"),{removedCells:o,totalTiles:l})},e}();o.default=n,cc._RF.pop()},{"../../debug/Debug":"Debug","../../shared/types":"types"}],NoMovesManager:[function(e,t,o){"use strict";cc._RF.push(t,"116fboEq2lDBr4VwqAGfK/E","NoMovesManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function e(e){this.maxReshuffles=e,this.reshufflesLeft=e}return e.prototype.reset=function(){this.reshufflesLeft=this.maxReshuffles},e.prototype.getReshufflesLeft=function(){return this.reshufflesLeft},e.prototype.canReshuffle=function(){return this.reshufflesLeft>0},e.prototype.useReshuffle=function(){return!(this.reshufflesLeft<=0||(this.reshufflesLeft--,0))},e}();o.default=i,cc._RF.pop()},{}],PopupNoMoves:[function(e,t,o){"use strict";cc._RF.push(t,"623b9xTfPBGuaXBB95oFqA+","PopupNoMoves");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=e("../debug/Debug"),p=e("../app/EventBus"),u=e("../app/AppSignals"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.titleLabel=null,t.reshufflesLabel=null,t.panel=null,t.okButton=null,t.baseScale=1,t}return r(t,e),t.prototype.onLoad=function(){this.panel||(this.panel=this.node),this.okButton||(this.okButton=this.getComponentInChildren(cc.Button)),this.baseScale=this.panel.scale,c.debugLog("PopupNoMoves","onLoad, node="+this.node.name+", panel="+this.panel.name+", okButton="+!!this.okButton)},t.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this.panel)},t.prototype.show=function(e){c.debugLog("PopupNoMoves","show(), node="+this.node.name+", reshufflesLeft="+e+", activeBefore="+this.node.active),this.titleLabel&&(this.titleLabel.string="\u041d\u0415\u0422 \u0425\u041e\u0414\u041e\u0412"),this.reshufflesLabel&&(this.reshufflesLabel.string="\u041f\u0435\u0440\u0435\u043c\u0435\u0448\u0435\u043a: "+e),this.node.active=!0,this.panel.opacity=0,this.panel.scale=.75*this.baseScale,cc.Tween.stopAllByTarget(this.panel),cc.tween(this.panel).to(.18,{opacity:255,scale:1.05*this.baseScale}).to(.09,{scale:this.baseScale}).start()},t.prototype.hide=function(){var e=this;c.debugLog("PopupNoMoves","hide(), node="+this.node.name),cc.Tween.stopAllByTarget(this.panel),cc.tween(this.panel).to(.12,{scale:.9*this.baseScale,opacity:0}).call(function(){e.node.active=!1,e.panel.scale=e.baseScale,e.panel.opacity=255}).start()},t.prototype.onOkClick=function(){c.debugLog("PopupNoMoves","onOkClick"),p.default.I.emit(u.AppSignal.NO_MOVES_OK_CLICKED)},n([a(cc.Label)],t.prototype,"titleLabel",void 0),n([a(cc.Label)],t.prototype,"reshufflesLabel",void 0),n([a(cc.Node)],t.prototype,"panel",void 0),n([a(cc.Button)],t.prototype,"okButton",void 0),n([l],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../app/AppSignals":"AppSignals","../app/EventBus":"EventBus","../debug/Debug":"Debug"}],PopupOkButton:[function(e,t,o){"use strict";cc._RF.push(t,"1be63plUwBMAo6y9KJru1/i","PopupOkButton");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=null,t.baseScale=1,t.isPressed=!1,t}return r(t,e),t.prototype.onLoad=function(){this.button||(this.button=this.getComponent(cc.Button)),this.baseScale=this.node.scale,this.node.on(cc.Node.EventType.TOUCH_START,this.onPress,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onRelease,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onRelease,this),this.node.on(cc.Node.EventType.MOUSE_DOWN,this.onPress,this),this.node.on(cc.Node.EventType.MOUSE_UP,this.onRelease,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this.onMouseEnter,this)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onPress,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onRelease,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onRelease,this),this.node.off(cc.Node.EventType.MOUSE_DOWN,this.onPress,this),this.node.off(cc.Node.EventType.MOUSE_UP,this.onRelease,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this.onMouseEnter,this)},t.prototype.onDisable=function(){cc.Tween.stopAllByTarget(this.node),this.node.scale=this.baseScale,this.isPressed=!1},t.prototype.onMouseEnter=function(){this.isPressed||(cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.08,{scale:1.06*this.baseScale}).start())},t.prototype.onMouseLeave=function(){this.isPressed||(cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.1,{scale:this.baseScale}).start())},t.prototype.onPress=function(){this.isPressed=!0,cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.06,{scale:.94*this.baseScale}).start()},t.prototype.onRelease=function(){this.isPressed=!1,cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.08,{scale:1.06*this.baseScale}).to(.08,{scale:this.baseScale}).start()},n([a(cc.Button)],t.prototype,"button",void 0),n([l],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],PopupSimple:[function(e,t,o){"use strict";cc._RF.push(t,"275a1vKP9lNZIyBvK+kax0B","PopupSimple");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.titleLabel=null,t.panel=null,t.okButton=null,t.onOk=null,t.baseScale=1,t}return r(t,e),t.prototype.onLoad=function(){this.panel||(this.panel=this.node),this.okButton||(this.okButton=this.getComponentInChildren(cc.Button)),this.baseScale=this.panel.scale},t.prototype.show=function(e){this.titleLabel&&null!=e&&(this.titleLabel.string=e),this.node.active=!0,this.panel.opacity=0,this.panel.scale=.75*this.baseScale,cc.Tween.stopAllByTarget(this.panel),cc.tween(this.panel).to(.18,{opacity:255,scale:1.05*this.baseScale}).to(.09,{scale:this.baseScale}).start()},t.prototype.hide=function(){var e=this;cc.Tween.stopAllByTarget(this.panel),cc.tween(this.panel).to(.12,{scale:.9*this.baseScale,opacity:0}).call(function(){e.node.active=!1,e.panel.scale=e.baseScale,e.panel.opacity=255}).start()},t.prototype.onOkButtonClick=function(){this.onOk&&this.onOk()},n([a(cc.Label)],t.prototype,"titleLabel",void 0),n([a(cc.Node)],t.prototype,"panel",void 0),n([a(cc.Button)],t.prototype,"okButton",void 0),n([l],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],TeleportController:[function(e,t,o){"use strict";cc._RF.push(t,"0ccdeaeWZhEHr04o/4VACt9","TeleportController"),Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../debug/Debug"),r=function(){function e(e){this.boardModel=null,this.active=!1,this.first=null,this.boardModel=e}return e.prototype.setBoard=function(e){this.boardModel=e,this.reset()},e.prototype.isActive=function(){return this.active},e.prototype.toggle=function(){return this.active=!this.active,this.resetSelection(),i.debugLog("TeleportController","Teleport mode = "+this.active),this.active},e.prototype.resetSelection=function(){this.first=null},e.prototype.reset=function(){this.resetSelection(),this.active=!1},e.prototype.handleClick=function(e){if(!this.active)return null;if(!this.boardModel)return null;var t={row:e.row,col:e.col};if(!this.first)return this.first=t,{type:"select",pos:t};if(this.first.row===t.row&&this.first.col===t.col){var o=this.first;return this.first=null,{type:"deselect",pos:o}}if(Math.abs(this.first.row-t.row)+Math.abs(this.first.col-t.col)!==1)return o=this.first,this.first=t,{type:"reselect",from:o,to:t};var r=this.first,n=t;return this.boardModel.swapTiles(r,n),this.first=null,this.active=!1,i.debugLog("TeleportController","Teleport swap performed"),{type:"swap",from:r,to:n}},e}();o.default=r,cc._RF.pop()},{"../../debug/Debug":"Debug"}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"33887GcwR9J95UYlrCXn74M","TileView");var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),n=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,s=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(s=(n<3?r(s):n>3?r(t,o,s):r(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../shared/types"),l=e("../app/EventBus"),a=e("../app/AppSignals"),c=e("../debug/Debug"),p=cc._decorator,u=p.ccclass,h=p.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=null,t.row=0,t.col=0,t.color=s.TileColor.Blue,t.baseScale=1,t.selected=!1,t}return r(t,e),t.prototype.onLoad=function(){this.button||(this.button=this.getComponent(cc.Button)),this.baseScale=this.node.scale},t.prototype.setup=function(e,t,o){this.row=e,this.col=t,this.color=o,this.setSelected(!1)},t.prototype.setSelected=function(e){this.selected!==e&&(this.selected=e,cc.Tween.stopAllByTarget(this.node),e?cc.tween(this.node).to(.08,{scale:1.1*this.baseScale}).to(.08,{scale:1.05*this.baseScale}).start():cc.tween(this.node).to(.1,{scale:this.baseScale}).start())},t.prototype.playSpawn=function(e){this.node.opacity=0,this.node.scale=.5*this.baseScale,cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.12,{opacity:255,scale:1.1*this.baseScale}).to(.08,{scale:this.baseScale}).call(function(){e&&e()}).start()},t.prototype.playBurn=function(e){cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.1,{scale:1.2*this.baseScale}).to(.15,{scale:.2*this.baseScale,opacity:0}).call(function(){e&&e()}).start()},t.prototype.playTeleportSwap=function(e,t){cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.12,{x:e.x,y:e.y,scale:1.12*this.baseScale}).to(.08,{scale:.98*this.baseScale}).to(.06,{scale:this.baseScale}).call(function(){t&&t()}).start()},t.prototype.onClick=function(){c.debugLog("TileView","CLICK row="+this.row+", col="+this.col+", color="+this.color);var e={row:this.row,col:this.col,color:this.color};l.default.I.emit(a.AppSignal.TILE_CLICKED,e)},n([h(cc.Button)],t.prototype,"button",void 0),n([u],t)}(cc.Component);o.default=d,cc._RF.pop()},{"../app/AppSignals":"AppSignals","../app/EventBus":"EventBus","../debug/Debug":"Debug","../shared/types":"types"}],types:[function(e,t,o){"use strict";var i;cc._RF.push(t,"2608fVJDMtNmq5G+K3kjAB3","types"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileSpecial=o.TILE_COLORS=o.TileColor=void 0,function(e){e.Green="green",e.Blue="blue",e.Purple="purple",e.Red="red",e.Yellow="yellow",e.MegaBomb="megaBomb"}(i=o.TileColor||(o.TileColor={})),o.TILE_COLORS=[i.Green,i.Blue,i.Purple,i.Red,i.Yellow],function(e){e.None="none",e.MegaBomb="mega_bomb"}(o.TileSpecial||(o.TileSpecial={})),cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(e,t){"use strict";cc._RF.push(t,"8ff39eCKmFEooE1GVQg5dGq","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["use_v2.1-2.2.1_cc.Toggle_event","AppConfig","AppSignals","EventBus","GameController","GameEntry","GameState","BombController","MegaBombController","NoMovesManager","TeleportController","BoardFiller","TileView","Debug","BoardModel","types","BackgroundFloat","BoosterBombButton","BoosterTeleportButton","HUDScore","PopupNoMoves","PopupOkButton","PopupSimple"]);