# Blast-пазл на TypeScript + Cocos Creator 2.4.12

Прототип игры в жанре **Blast** по тестовому заданию.  
Игрок кликает по группам соседних тайлов одного цвета, зарабатывает очки и укладывается в ограничение по ходам.  
Дополнительно реализованы бустеры и супер-тайл (мега-бомба) с полным очищением поля.

---

## Содержание

- [Игровая механика](#игровая-механика)
- [Соответствие требованиям тестового](#соответствие-требованиям-тестового)
- [Реализованные дополнительные задания](#реализованные-дополнительные-задания)
- [Архитектура и разделение логики и отображения](#архитектура-и-разделение-логики-и-отображения)
- [Технологический стек](#технологический-стек)
- [Запуск проекта](#запуск-проекта)
- [Настройки игры](#настройки-игры)

---

## Игровая механика

- Игровое поле размера **N × M** (по умолчанию 9×9).
- В каждой ячейке находится тайл одного из пяти цветов.
- При клике на тайл:
  - находится **группа 4-соседних** тайлов того же цвета;
  - если размер группы ≥ 2 — вся группа **сгорает**;
  - оставшиеся тайлы **падают вниз**;
  - пустые клетки сверху **заполняются новыми случайными тайлами**.
- Цель: набрать заданное количество очков (**`targetScore`**) за ограниченное число ходов (**`startMoves`**).
- При отсутствии возможных ходов включается логика **авто-перемешивания** (см. ниже).

Все основные параметры (размер поля, количество ходов, цель по очкам и т.п.) настраиваются в файле  
`assets/scripts/app/AppConfig.ts`.

---

## Соответствие требованиям тестового

### Основное задание

1. **Механика сжигания и падения тайлов**

   - Реализована модель поля `BoardModel`, которая:
     - генерирует поле случайными цветами;
     - ищет группы одинаковых тайлов (DFS по 4-соседям);
     - удаляет группы;
     - применяет «гравитацию» (тайлы падают вниз по колонкам);
     - заполняет свободные клетки новыми тайлами.
   - Класс `BoardFiller` отвечает за создание и анимацию `TileView`:
     - анимация сгорания тайла;
     - анимация падения;
     - анимация появления нового тайла.

2. **Подсчёт оставшихся ходов и набранных очков**

   - Класс `GameState` хранит:
     - текущий счёт;
     - оставшиеся ходы;
     - цель по очкам;
     - количество доступных перемешек, бомб и телепортов;
     - признак окончания игры и причину (`win` / `lose`).
   - HUD (`HUDScore`) отображает очки, цель и оставшиеся ходы.

3. **Обработка выигрыша и проигрыша**

   - При выполнении/невыполнении цели по очкам за отведённые ходы, а также при невозможности сделать ход:
     - выставляется флаг `gameOver` в `GameState`;
     - `GameController` вызывает соответствующие колбэки `onWin` / `onLose`;
     - `GameEntry` показывает попапы **ПОБЕДА** / **ПРОИГРЫШ** (`PopupSimple`).

4. **Техстек и ограничения**

   - TypeScript + **Cocos Creator 2.4.12**.
   - Используется приложенный набор ассетов (фон, UI, тайлы, попапы).
   - **Физический движок не используется** — вся логика падения реализована вручную в модели.
   - Код организован с учётом принципов ООП и SOLID:
     - отдельные классы для модели (`BoardModel`), состояния (`GameState`),
       визуализации (`BoardFiller`, `TileView`), контроллеров (`GameController`, бустеры, no-moves);
     - слабое связывание через `EventBus` и сигналы `AppSignal`.

5. **GitHub / GitHub Pages**
   - Исходники подготовлены под размещение на GitHub.
   - Готовая веб-сборка лежит в папке `docs/` и автоматически
     публикуется через GitHub Pages из ветки `main`.
   - Ссылка на рабочий проект:
     https://prakapovichdev.github.io/match-blast/

---

## Реализованные дополнительные задания

1. ### Автоматическое перемешивание поля

   - Класс `NoMovesManager` (логика обёрнута в `GameController.ensureHasMoves()`):
     - после каждого хода проверяет, есть ли вообще возможные группы размером ≥ 2;
     - если ходов нет, но есть оставшиеся **авто-перемешки**, показывает попап **«Нет ходов»** (`PopupNoMoves`);
     - по кнопке OK:
       - уменьшается счётчик перемешек;
       - поле полностью пересобирается случайным образом (`BoardModel.randomFill`);
       - проверка повторяется;
     - если перемешек больше нет и ходов тоже — **проигрыш**.

2. ### Бустер «Бомба»

   - Класс `BombController`:
     - обрабатывает режим «бомбы» (включение/выключение);
     - по клику отдаёт список клеток вокруг точки клика в квадратном радиусе **R**.
   - `GameController`:
     - списывает заряд бомбы из `GameState`;
     - начисляет очки за уничтоженное количество тайлов;
     - запускает визуальные эффекты:
       - `BoardFiller.playBombShake()` — лёгкий shake всего поля;
       - `BoardFiller.playBombFlash()` — локальная вспышка вокруг центра взрыва.

3. ### Бустер «Телепорт»

   - Класс `TeleportController`:
     - обрабатывает первый и второй клик по тайлам в режиме телепорта;
     - возвращает результат (`select` / `reselect` / `swap`), который использует `GameController`.
   - `GameController`:
     - логически меняет местами тайлы в `BoardModel`;
     - анимирует swap через `TileView.playTeleportSwap()`;
     - после окончания анимации заново проверяет наличие ходов и состояние игры.

4. ### Супер-тайл (мега-бомба)

   - Класс `MegaBombController` (логика создания инкапсулирована, вызовы идут из `GameController`):
     - если размер группы **≥ 5** (`MEGA_BOMB_MIN_GROUP`), при клике создаётся **мега-бомба**:
       - все тайлы группы, **кроме клетки клика**, сгорают;
       - в модели в этой клетке записывается специальный цвет `TileColor.MegaBomb`;
       - `BoardFiller.setMegaBombVisual()` меняет спрайт на `block_bomb_max`.
   - При клике по мега-бомбе:
     - собирается список всех непустых тайлов на поле;
     - начисляются очки как за большую бомбу;
     - запускается глобальный взрыв: shake + крупная вспышка;
     - очищается всё поле и запускается стандартный пайплайн падения/рефила.

---

## Архитектура и разделение логики и отображения

**Основная цель** — максимально разделить «чистую» игровую логику и слой представления.

### Логика (domain / app)

- `BoardModel` — структура и правила работы поля:
  - сетка цветов;
  - поиск групп;
  - удаление;
  - гравитация;
  - дозаполнение;
  - проверка наличия ходов.
- `GameState` — состояние прогресса игрока и параметров уровня.
- `GameController` — «мозг» игры:
  - принимает события кликов по тайлам и бустерам;
  - вызывает методы модели / стейта;
  - решает, когда показаны попапы, победа/поражение;
  - общается с UI через колбэки и `EventBus`.
- `TeleportController`, `BombController`, `MegaBombController`, `NoMovesManager` — отдельные контроллеры для режимов/подзадач.

### Отображение (board / ui)

- `BoardFiller` — отвечает за создание и анимацию `TileView` на сцене:
  - пересчёт размеров и позиций тайлов по размеру борда;
  - предварительная верстка поля;
  - анимации падения, спавна, сжигания, бомбовых эффектов.
- `TileView` — представление одного тайла:
  - хранит свои координаты;
  - отсылает клики в `EventBus`;
  - имеет анимации выделения, спавна, сгорания, телепорта.
- `HUDScore`, `BoosterTeleportButton`, `BoosterBombButton` — отрисовка очков, ходов и состояний бустеров.
- `PopupWin`, `PopupLose`, `PopupNoMoves` — простые попапы с общим базовым классом (`PopupSimple` / `PopupNoMoves`).

Такое разделение соответствует пункту **«Разделить логику игры и отображение»** из задания.

---

## Технологический стек

- **TypeScript**
- **Cocos Creator 2.4.12**
- Встроенная система анимаций и `cc.tween`
- Без использования физического движка

---

## Запуск проекта

1. Установить **Cocos Creator 2.4.x**.
2. Открыть этот репозиторий через **Cocos Dashboard** или меню `Open Project`.
3. Выбрать сцену `assets/scenes/Main.fire`.
4. Запустить превью:
   - через кнопку ▶ вверху редактора;
   - или собрать в `web-mobile` и открыть в браузере.
5. Для GitHub Pages:
   - выполнить сборку `web-mobile`;
   - залить содержимое папки `build/web-mobile` в ветку `gh-pages`
     и включить GitHub Pages в настройках репозитория.

---

## Настройки игры

Основные настройки находятся в:

- `assets/scripts/app/AppConfig.ts`

```ts
export const BoardConfig = {
  rows: 9,
  cols: 9,
};

export const GameConfig = {
  minGroupSize: 2,
  baseScorePerTile: 10,
  startMoves: 20,
  targetScore: 500,

  reshuffleLimit: 3,

  startTeleports: 5,
  bombRadius: 1,
  startBombs: 3,
};
```
